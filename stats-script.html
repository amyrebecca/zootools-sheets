<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/2.4.2/math.min.js"></script>
<script type="text/javascript">

var columnDefs = null;
var template = null;
var statTemplate = null;

function calculateNew(){
	var varName = document.querySelector('#varName').value;
	google.script.run.withSuccessHandler(function(res){
		var summary = {
			name: varName,
			min: math.round(math.min(res),7),
			max: math.round(math.max(res),7),
			mean: math.round(math.mean(res),7),
			stdev: math.round(math.std(res),7)
		}

		document.querySelector('#resultList').innerHTML += statTemplate(summary);
	}).clientGetValues(varName);
}

var compile = function(selector){
	var r = /(\{\{.+?\}\})/;
	var elem = document.querySelector(selector);
	var markup = elem.outerHTML;
	elem.remove();
	markup = markup.replace(/\s+/,' ');

	var fragments = markup.split(r);

	var template = (function(tpl){
		return function(obj){
			var r = /(\{\{.+?\}\})/;
			var accum = [];
			for(var idx in fragments){
				var fragment = fragments[idx];
				if(r.test(fragment)){
					fragment = fragment.replace(/(\{\{)|(\}\})/g,'');
					accum.push(obj[fragment]);
				} else {
					accum.push(fragment);
				}
			}
			return accum.join('');
		};
	})(fragments);

    return template;
};

var statTemplate = compile('#result');
document.querySelector('#resultList').className = '';

</script>

